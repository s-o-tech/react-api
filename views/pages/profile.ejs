<!DOCTYPE html>
<html>
<head>
    <%- include('../partials/head'); %>
</head>
<body>
<%- include('../partials/header'); %>
<div class="container">
    <div class="row">
        <aside class="col-md-4">
            <section class="user_info">
                <%- include('../partials/user_info'); %>
            </section>
            <section class="stats">
                <%- include('../partials/stats'); %>
            </section>
        </aside>

        <main class="col-md-8">
            <% if (current_user.id !== user.id) { %>
                <% if (relationship === null) { %>
                    <form action="/relationship" method="post">
                        <input type="hidden" name="followed_id" value=<%= user.id %>>
                        <button class="btn btn-sm btn-primary" type="submit">Follow</button>
                    </form>
                <% } else { %>
                    <form action="/relationship/delete" method="post">
                        <input type="hidden" name="followed_id" value=<%= user.id %>>
                        <input type="hidden" name="relationship_id" value=<%= relationship.id %>>
                        <button class="btn btn-sm btn-primary" type="submit">UnFollow</button>
                    </form>
                <% } %>
            <% } %>
            <ul>
                <h2>Microposts (<%= total %>) </h2>
                <% for(let micropost of microposts){ %>
                    <hr>
                    <%= micropost.content %>
                    <% if (current_user.id === user.id) { %>
                        <form action="/" method="post">
                            <input type="hidden" name="postId" value=<%= micropost.id %>>
                            <button class="btn btn-sm btn-primary" type="submit">delete</button>
                        </form>
                    <% } %>
                <% } %>
            </ul>
            <nav aria-label="Page navigation example">
                <ul class="pagination">
                    <% if (pagination.currentPage != 1){ %>
                        <li class="page-item">
                            <a class="page-link" href="?page=<%= pagination.currentPage - 1 %>" aria-label="Previous">
                                Previous
                            </a>
                        </li>
                    <% } else { %>
                        <li class="page-item disabled">
                            <a class="page-link" aria-label="Previous">
                                Previous
                            </a>
                        </li>
                    <% } %>

                    <% for (let i = pagination.currentPage - 2;i <= pagination.currentPage + 2 && i <= pagination.lastPage; i++){ %>
                        <% if (i < 1) continue; %>
                        <% if ( i == pagination.currentPage){ %>
                            <li class="page-item active"><a class="page-link" href="?page=<%= i %>"><%= i %></a></li>
                        <% } else { %>
                            <li class="page-item"><a class="page-link" href="?page=<%= i %>"><%= i %></a></li>
                        <% } %>
                    <% } %>

                    <% if (pagination.currentPage != pagination.lastPage){ %>
                        <li class="page-item">
                            <a class="page-link" href="?page=<%= pagination.currentPage + 1 %>" aria-label="Next">
                                Next
                            </a>
                        </li>
                    <% } else { %>
                        <li class="page-item disabled">
                            <a class="page-link" aria-label="Next">
                                Next
                            </a>
                        </li>
                    <% } %>
                </ul>
            </nav>
        </main>
    </div>

</div>
<%- include('../partials/footer'); %>
</body>
</html>